{"organizations": [], "uuid": "c490c02d07de6d7a6d91bde78787c84aba68582a", "thread": {"social": {"gplus": {"shares": 15}, "pinterest": {"shares": 0}, "vk": {"shares": 0}, "linkedin": {"shares": 29}, "facebook": {"likes": 296, "shares": 296, "comments": 0}, "stumbledupon": {"shares": 0}}, "site_full": "www.gamasutra.com", "main_image": "http://www.gamasutra.com/blogs/edit/img/portrait/1009368/portrait.png", "site_section": "http://feeds.feedburner.com/GamasutraFeatureArticles/", "section_title": "Gamasutra News", "url": "http://www.gamasutra.com/blogs/MingLunChou/20160511/272458/A_Brain_Dump_of_What_I_Worked_on_for_Uncharted_4.php", "country": "US", "domain_rank": 15233, "title": "Don't Miss: A brain dump of what I worked on for Naughty Dog's Uncharted 4", "performance_score": 2, "site": "gamasutra.com", "participants_count": 0, "title_full": "Don't Miss: A brain dump of what I worked on for Naughty Dog's Uncharted 4", "spam_score": 0.0, "site_type": "blogs", "published": "2017-03-14T02:29:00.000+02:00", "replies_count": 0, "uuid": "c490c02d07de6d7a6d91bde78787c84aba68582a"}, "author": "", "url": "http://www.gamasutra.com/blogs/MingLunChou/20160511/272458/A_Brain_Dump_of_What_I_Worked_on_for_Uncharted_4.php", "ord_in_thread": 0, "title": "Don't Miss: A brain dump of what I worked on for Naughty Dog's Uncharted 4", "locations": [], "entities": {"persons": [{"name": "ming-lun chou", "sentiment": "negative"}, {"name": "bruce straley", "sentiment": "none"}, {"name": "tess", "sentiment": "none"}, {"name": "joel", "sentiment": "none"}, {"name": "elena", "sentiment": "none"}, {"name": "sam", "sentiment": "none"}, {"name": "gamasutra", "sentiment": "none"}, {"name": "ellie", "sentiment": "none"}, {"name": "neil druckmann", "sentiment": "none"}, {"name": "marina del rey", "sentiment": "none"}, {"name": "nate", "sentiment": "none"}], "locations": [{"name": "maya", "sentiment": "none"}, {"name": "santa monica", "sentiment": "none"}, {"name": "czech republic skydance interactive", "sentiment": "none"}, {"name": "prague", "sentiment": "none"}, {"name": "madagascar", "sentiment": "none"}], "organizations": [{"name": "npc", "sentiment": "none"}, {"name": "bohemia interactive simulations", "sentiment": "none"}, {"name": "bayer", "sentiment": "none"}, {"name": "medic sidekicks  medic", "sentiment": "none"}, {"name": "wikipedia", "sentiment": "none"}]}, "highlightText": "", "language": "english", "persons": [], "text": "A Brain Dump of What I Worked on for Uncharted 4 by Ming-Lun Chou on 05/11/16 02:22:00 pm The following blog post, unless otherwise noted, was written by a member of Gamasutras community. The thoughts and opinions expressed are those of the writer and not Gamasutra or its parent company. \nThis post is part of My Career Series . \nNow that Uncharted 4 is released, I am able to talk about what I worked on for the project. I mostly worked on AI for single-player buddies and multiplayer sidekicks, as well as some gameplay logic. I’m leaving out things that never went in to the final game and some minor things that are too verbose to elaborate on. So here it goes: \nThe Post System \nBefore I start, I'd like to mention the post system we used for NPCs. I did not work on the core logic of the system; I helped writing some client code that makes use of this system. Posts are discrete positions within navigable space, mostly generated from tools and some hand-placed by designers. Based on our needs, we created various post selectors that rate posts differently (e.g. stealth post selector, combat post selector), and we pick the highest-rated post to tell an NPC to go to. Buddy Follow \nThe buddy follow system was derived from The Last of Us . The basic idea is that buddies pick positions around the player to follow. These potential positions are fanned out from the player, and must satisfy the following linear path clearance tests: player to position, position to a forward-projected position, forward-projected position to the player. \nClimbing is something present in Uncharted 4 that is not in The Last of Us. To incorporate climbing into the follow system, we added the climb follow post selector that picks climb posts for buddies to move to when the player is climbing. \nIt turned out to be trickier than we thought. Simply telling buddies to use regular follow logic when the player is not climbing, and telling them to use climb posts when the player is climbing, is not enough. If the player quickly switch between climbing and non-climbing states, buddies would oscillate pretty badly between the two states. So we added some hysteresis, where the buddies only switch states when the player has switched states and moved far enough while maintaining in that state. In general, hysteresis is a good idea to avoid behavioral flickering. Buddy Lead \nIn some scenarios in the game, we wanted buddies to lead the way for the player. The lead system is ported over from The Last of Us and updated, where designers used splines to mark down the general paths we wanted buddies to follow while leading the player. \nIn case of multiple lead paths through a level, designers would place multiple splines and turned them on and off via script. \nThe player's position is projected onto the spline, and a lead reference point is placed ahead by a distance adjustable by designers. When this lead reference point passes a spline control point marked as a wait point, the buddy would go to the next wait point. If the player backtracks, the buddy would only backtrack when the lead reference point gets too far away from the furthest wait point passed during last advancement. This, again, is hysteresis added to avoid behavioral flickering. \nWe also incorporated dynamic movement speed into the lead system. \"Speed planes\" are placed along the spline, based on the distance between the buddy and the player along the spline. There are three motion types NPCs can move in: walk, run, and sprint. Depending on which speed plane the player hits, the buddy picks an appropriate motion type to maintain distance away from the player. Designers can turn on and off speed planes as they see fit. Also, the buddy's locomotion animation speed is slightly scaled up or down based on the player's distance to minimize abrupt movement speed change when switching motion types. Buddy Cover Share \nIn The Last of Us, the player is able to move past a buddy while both remain in cover. This is called cover share. \nIn The Last of Us, it makes sense for Joel to reach out to the cover wall over Ellie and Tess, who have smaller profile than Joel. But we thought that it wouldn't look as good for Nate, Sam, Sully, and Elena, as they all have similar profiles. Plus, Uncharted 4 is much faster-paced, and having Nate reach out his arms while moving in cover would break the fluidity of the movement. So instead, we decided to simply make buddies hunker against the cover wall and have Nate steer slightly around them. \nThe logic we used is very simple. If the projected player position based on velocity lands within a rectangular boundary around the buddy's cover post, the buddy aborts current in-cover behavior and quickly hunkers against the cover wall. Medic Sidekicks \nMedic sidekicks in multiplayer require a whole new behavior that is not present in single-player: reviving downed allies and mirroring the player's cover behaviors. \nMedics try to mimic the player's cover behavior, and stay as close to the player as possible, so when the player is downed, they are close by to revive the player. If a nearby ally is downed, they would also revive the ally, given that the player is not already downed. If the player is equipped with the RevivePak mod for medics, they would try to throw RevivePaks at revive targets before running to the targets for revival; throwing RevivePaks reuses the grenade logic for trajectory clearance test and animation playback, except that grenades were swapped out with RevivePaks. Stealth Grass \nCrouch-moving in stealth grass is also something new in Uncharted 4. For it to work, we need to somehow mark the environment, so that the player gameplay logic knows whether the player is in stealth grass. Originally, we thought about making the background artists responsible of marking collision surfaces as stealth grass in Maya, but found out that necessary communication between artists and designers made iteration time too long. So we arrived at a different approach to mark down stealth grass regions. An extra stealth grass tag is added for designers in the editor, so they could mark the nav polys that they'd like the player to treat as stealth grass, with high precision. With this extra information, we can also rate stealth posts based on whether they are in stealth grass or not. This is useful for buddies moving with the player in stealth. Perception \nSince we don't have listen mode in Uncharted 4 like The Last of Us, we needed to do something to make the player aware of imminent threats, so the player doesn't feel overwhelmed by unknown enemy locations. Using the enemy perception data, we added the colored threat indicators that inform the player when an enemy is about to notice him/her as a distraction (white), to perceive a distraction (yellow), and to acquire full awareness (orange). We also made the threat indicator raise a buzzing background noise to build up tension and set off a loud stinger when an enemy becomes fully aware of the player, similar to The Last of Us. Investigation \nThis is the last major gameplay feature I took part in on before going gold. I don't usually go to formal meetings at Naughty Dog, but for the last few months before gold, we had a at least one meeting per week driven by Bruce Straley or Neil Druckmann , focusing on the AI aspect of the game. Almost after every one of these meetings, there was something to be changed and iterated for the investigation system. I went through many iterations before arriving at what we shipped with the final game. \nThere are two things that create distractions and would cause enemies to investigate: player presence and dead bodies. When an enemy registers a distraction (distraction spotter), he would try to get a nearby ally to investigate with him as a pair. The closer one to the distraction becomes the investigator, and the other becomes the watcher. The distraction spotter can become an investigator or a watcher, and we set up different dialog sets for both scenarios (\"There's something over there. I'll check it out.\" versus \"There's something over there. You go check it out.\" \nIn order to make the start and end of investigation look more natural, we staggered the timing of enemy movement and the fading of threat indicators, so the investigation pair don' \nDialog looks refers to the logic that makes characters react to conversations, such as looking at the other people and hand gestures. Previously in The Last of Us, people spent months annotating all in-game scripted dialogs with looks and gestures by hand. This was something we didn' \nOne of the problems we had early on regarding the jeep driving section in the Madagascar city level, is that the player' \nThere are multiple ways to kill enemy vehicles: kill the driver, shoot the vehicle enough times, bump into an enemy bike with your jeep, and ram your jeep into an enemy \nFor bumped deaths of enemy bikes, we used the bike' \nAs for jeep spin-outs, the jeep' \nWhen playing death animations, there's a chance that the dead vehicle can penetrate walls. A sphere cast is used, from the vehicle's ideal position along the rail if it weren't dead, to where the vehicle' \nWe made a special type of vehicle death, called vehicle death hint. They are \nWe wanted to eliminate geometry clipping the camera when the camera gets too close to environmental objects, mostly foliage. So we decided to fade out pixels in pixel shaders based on how close the pixels are to the camera. Using transparency was not an option, because transparency is not cheap, and there's just too much foliage. Instead, we went with dithering , combining a pixel's distance from the camera and a patterned Bayer matrix \nOur original Bayer matrix was an 8x8 matrix shown on this Wikipedia page \nThis is a really minor contribution, but I'd still like to mention it. A couple weeks before the 2015 E3 demo, I pointed out that the tower explosion was seen and heard simultaneously and that didn' \nI didn't switch to Traditional Chinese text and subtitles until two weeks before we were locking down for gold, and I found some translation errors. Most of the errors were literal translations from English to Traditional Chinese and just did' That' \nThese are pretty much the things I worked on for Uncharted 4 that are Bohemia Interactive Simulations - CZ — Prague, Czech Republic Skydance Interactive — Marina Del Rey,   [03.12.17] thatgamecompany — Santa Monica,   [03.11.17] thatgamecompany — Santa Monica,   [03.11.17]", "external_links": [], "published": "2017-03-14T02:29:00.000+02:00", "crawled": "2017-03-14T01:23:35.120+02:00", "highlightTitle": ""}